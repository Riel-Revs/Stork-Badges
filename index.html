
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stork Community ID Badge Generator</title>
  <style>
    body { font-family: Arial, sans-serif; background: #0d0d0d; color: #fff; text-align: center; padding: 20px; }
    h1 { color: #20B2AA; }
    form { max-width: 400px; margin: 0 auto 20px; text-align: left; }
    input, button, select { width: 100%; margin: 10px 0; padding: 10px; border-radius: 6px; border: none; }
    button { background: #001F3F; color: #20B2AA; font-weight: bold; cursor: pointer; }
    canvas { display: block; margin: 20px auto; border: 1px solid #ccc; }
    #download { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Stork Community ID Badge Generator</h1>
  <form id="badgeForm">
    <label>X Handle:</label>
    <input type="text" id="xHandle" placeholder="@YourHandle" required>
    <label>A.k.a (Nickname):</label>
    <input type="text" id="nickname" placeholder="Your Nickname">
    <label>Discord Role:</label>
    <select id="discordRole">
      <option value="winged">Winged</option>
      <option value="peep">Peep</option>
      <option value="songbird">Songbird</option>
      <option value="wayfinder">Wayfinder</option>
      <option value="mod">Mod</option>
      <option value="skymaster">Skymaster</option>
    </select>
    <label>Profile Picture (Upload or URL):</label>
    <input type="file" id="pfpFile" accept="image/*">
    <input type="text" id="pfpUrl" placeholder="Or enter image URL">
    <button type="submit">Generate Badge</button>
  </form>

  <canvas id="badgeCanvas" width="900" height="450"></canvas>
  <div id="download"></div>

  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
    const form = document.getElementById('badgeForm');
    const canvas = document.getElementById('badgeCanvas');
    const ctx = canvas.getContext('2d');

    function loadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = "Anonymous";
        img.src = src;
        img.onload = () => resolve(img);
        img.onerror = reject;
      });
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const xHandle = document.getElementById('xHandle').value;
      const nickname = document.getElementById('nickname').value;
      const discordRole = document.getElementById('discordRole').value;
      let pfpSrc = document.getElementById('pfpUrl').value;

      const pfpFile = document.getElementById('pfpFile').files[0];
      if (pfpFile) {
        pfpSrc = await new Promise(resolve => {
          const reader = new FileReader();
          reader.onload = (e) => resolve(e.target.result);
          reader.readAsDataURL(pfpFile);
        });
      }

      let pfpImage = null;
      if (pfpSrc) {
        try {
          pfpImage = await loadImage(pfpSrc);
        } catch (err) {
          alert("Could not load profile picture.");
        }
      }

      const logoImg = await loadImage("logo.png");
      const roleIcon = await loadImage("role-" + discordRole + ".png");

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw front card (left)
      drawCard(50, 50, xHandle, nickname, discordRole, pfpImage, logoImg, roleIcon, "front");

      // Draw back card (right)
      drawCard(500, 50, xHandle, nickname, discordRole, null, logoImg, roleIcon, "back");

      const downloadDiv = document.getElementById('download');
      downloadDiv.innerHTML = '<a href="' + canvas.toDataURL('image/png') + '" download="stork-badge.png">Download Your Badge</a>';
    });

    function drawSlotAndRope(ctx, xOffset) {
      // Rope (neutral gray)
      ctx.strokeStyle = "#cccccc";
      ctx.lineWidth = 6;
      ctx.beginPath();
      ctx.moveTo(xOffset + 120, 40);
      ctx.quadraticCurveTo(xOffset + 160, 0, xOffset + 200, 40);
      ctx.stroke();

      // Slot (teal)
      ctx.fillStyle = "#E0F9FF";
      ctx.strokeStyle = "#001F3F";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.roundRect(xOffset + 140, 45, 40, 12, 6);
      ctx.fill();
      ctx.stroke();
    }

    function drawCard(xOffset, yOffset, handle, nickname, role, pfpImage, logoImg, roleIcon, side) {
      // Card background
      ctx.fillStyle = "#001F3F";
      ctx.fillRect(xOffset, yOffset, 350, 400);

      // Border
      ctx.strokeStyle = "#20B2AA";
      ctx.lineWidth = 3;
      ctx.strokeRect(xOffset, yOffset, 350, 400);

      // Rope + slot
      drawSlotAndRope(ctx, xOffset);

      if (side === "front") {
        // Profile picture
        if (pfpImage) {
          ctx.save();
          ctx.beginPath();
          ctx.arc(xOffset+175, yOffset+150, 70, 0, Math.PI * 2);
          ctx.closePath();
          ctx.clip();
          ctx.drawImage(pfpImage, xOffset+105, yOffset+80, 140, 140);
          ctx.restore();

          // Glow ring (teal)
          ctx.strokeStyle = "#20B2AA";
          ctx.lineWidth = 6;
          ctx.beginPath();
          ctx.arc(xOffset+175, yOffset+150, 72, 0, Math.PI * 2);
          ctx.stroke();
        }

        // Handle (teal)
        ctx.fillStyle = "#20B2AA";
        ctx.font = "bold 22px Arial";
        ctx.fillText(handle.replace("@",""), xOffset+50, yOffset+270);

        // Role (white + icon)
        ctx.fillStyle = "#FFFFFF";
        ctx.font = "18px Arial";
        ctx.drawImage(roleIcon, xOffset+50, yOffset+280, 24, 24);
        ctx.fillText(role.charAt(0).toUpperCase() + role.slice(1), xOffset+80, yOffset+300);

        // Nickname (white)
        if (nickname) {
          ctx.fillStyle = "#FFFFFF";
          ctx.font = "italic 16px Arial";
          ctx.fillText("A.k.a " + nickname, xOffset+50, yOffset+330);
        }

        // Logo bottom-right
        ctx.drawImage(logoImg, xOffset+250, yOffset+340, 70, 40);
      } else {
        // Back side watermark
        ctx.globalAlpha = 0.1;
        ctx.drawImage(logoImg, xOffset+100, yOffset+100, 150, 100);
        ctx.globalAlpha = 1.0;

        // Handle
        ctx.fillStyle = "#20B2AA";
        ctx.font = "bold 18px Arial";
        ctx.fillText(handle, xOffset+30, yOffset+70);

        // Role + icon
        ctx.drawImage(roleIcon, xOffset+30, yOffset+85, 24, 24);
        ctx.fillStyle = "#FFFFFF";
        ctx.font = "16px Arial";
        ctx.fillText(role.charAt(0).toUpperCase() + role.slice(1), xOffset+60, yOffset+105);

        // Nickname
        if (nickname) {
          ctx.fillStyle = "#FFFFFF";
          ctx.font = "italic 14px Arial";
          ctx.fillText("A.k.a " + nickname, xOffset+30, yOffset+130);
        }

        // QR Code
        const qrCanvas = document.createElement("canvas");
        QRCode.toCanvas(qrCanvas, "https://www.stork.network/", { width: 120 }, function (error) {
          if (!error) {
            ctx.drawImage(qrCanvas, xOffset+110, yOffset+200);
            ctx.fillStyle = "#FFFFFF";
            ctx.font = "14px Arial";
            ctx.fillText("stork.network", xOffset+130, yOffset+330);
          }
        });

        // Logo bottom-right
        ctx.drawImage(logoImg, xOffset+250, yOffset+340, 70, 40);
      }
    }
  </script>
</body>
</html>
